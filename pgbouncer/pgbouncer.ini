[databases]
# Map Temporal databases through to the Azure Postgres upstream. PgBouncer will
# handle TLS to the upstream server using the CA file mounted below.
# Connection string may include sslmode and sslrootcert; PgBouncer will use
# server-side TLS settings below instead.
temporal = host=fastorc-psql2.postgres.database.azure.com port=5432 dbname=temporal user=djw password=Domjadon96
temporal_visibility = host=fastorc-psql2.postgres.database.azure.com port=5432 dbname=temporal_visibility user=djw password=Domjadon96

[pgbouncer]
listen_addr = 0.0.0.0
listen_port = 5432
auth_type = trust
auth_file = /etc/pgbouncer/userlist.txt
pool_mode = session
max_client_conn = 200
default_pool_size = 20
reserve_pool_size = 5
reserve_pool_timeout = 5
# Tell PgBouncer to use TLS when connecting to the PostgreSQL server (upstream)
server_tls_sslmode = verify-full
server_tls_ca_file = /etc/ssl/certs/azure-postgres-ca.crt

# Logging / runtime
logfile = /dev/stdout
pidfile = /var/run/pgbouncer/pgbouncer.pid
admin_users = postgres
# Ignore startup parameters that PgBouncer cannot forward to the server
ignore_startup_parameters = extra_float_digits

# Don't enable client TLS for local dev; Temporal clients talk to PgBouncer over plain TCP
# client_tls_sslmode = disable
